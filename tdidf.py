import pandas as pd
import pefile
import os 
from sklearn.feature_extraction.text import TfidfVectorizer

filepath = '/home/student/Downloads/Malware'

def makeTotalCorpus():
	all_executable_apis = []
	samples = os.listdir(filepath)
	for sample in samples:
		currentCorpus = extractImports(sample)
		for call in currentCorpus:
			all_executable_apis.add(call)
	all_executable_apis.sort()
	return all_executable_apis

def extractImports(sample):
	global filepath
	currentCorpus = []
	try:
		executablePath = filepath + '/' + sample
		executable = pefile.PE(executablePath)
		for IMAGE_IMPORT_DESCRIPTOR in executable.DIRECTORY_ENTRY_IMPORT:
			for function in IMAGE_IMPORT_DESCRIPTOR.imports:
				currentCorpus.add(function.name.decode())
		return currentCorpus
	except:
		pass

def main():
	global filepath
	totalCorpus = makeTotalCorpus()
	os.listdir(filepath)
	for sameple in samples:
		currentCorpus = extractImports(sameple)
		for apiCall in currentCorpus:
			if apiCall in IDFs:
				continue
			else:
				count = 0
				for call in totalCorpus:
					if apiCall == call:
						count += 1
				IDFs[apiCall] = count
	print(IDFs)


if __name__ == '__main__':
	main()
