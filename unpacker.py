import subprocess
import os

filepath = 'samples/Malware'

def main():
	global filepath
	malwareSamples = os.listdir(filepath)
	for sample in malwareSamples:
		print(f'[+] Analyzing /home/student/Downloads/Malware/{sample}')
		analysis = subprocess.run(["diec", "-rd", f"{sample}"], capture_output=True).stdout
		if "Packer:" in analysis.decode():
			splitResults = analysis.decode().split('\n')
			for item in splitResults:
				if "Packer" in item:
					packer = item.split(':')[1].strip().lower()
					print('\t[+] Sample is using UPX Packer')
					if "upx" in packer:
						os.system(f'upx -d /home/student/Downloads/Malware/{sample}')
					else:
						print('[-] Not Using UPX Packer Malware Being Skipped')
						os.system(f'rm -f /home/student/Downloads/Malware/{sample}')

if __name__ == '__main__':
	main()
