import subprocess
import os

filepath = '/home/student/Downloads/Malware'

def main():
	global filepath
	malwareSamples = os.listdir(filepath)
	for sample in malwareSamples:
		print(f'[+] Analyzing {sample}')
		analysis = subprocess.run(["diec", "-rd", f"{sample}"], capture_output=True).stdout
		if "Packer:" in analysis:
			splitResults = analysis.split('\n')
			for item in splitResults:
				if "Packer" in item:
					packer = item.split(':')[0].strip().lower()
					break
			print('\t[+] Sample is using UPX Packer')
			if "upx" in packer:
				os.system(f'upx -d {sample}')
			else:
				print('[-] Not Using UPX Packer Malware Being Skipped')
				os.system(f'rm -f {sample}')

if __name__ == '__main__':
	main()
